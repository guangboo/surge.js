!function(a){function h(a){return!!a&&(!(a instanceof Array)||a.length>0)}function i(a){return!/\S/.test(a)}function j(a){this.source=a,this.position=0,this.length=a.length}function m(a){return a.replace(/("|')/g,"\\$1").replace(/(\t|\r|\n)/g,function(a){return l[a.charCodeAt()]})}var d,e,f,g,k,l,n,b=a.surge={};b.version="0.2.2 Alpha",b.debug=!0,b.__builtins={},b.register=function(a,b){if(/^[_a-zA-Z]\w*/.test(a))return this.__builtins[a]=b,this;throw'"'+a+'" is not valid filter name.'},d=/^\s+|\s+$/g,e=/(\w+)\s+in\s+(.*)/,f=/((?:\w+)\s*=\s*(?:[\w\.]+))+/g,g={"<":"&lt;",">":"&gt;",'"':"&#39;","'":"&quot;","&":"&amp;"},String.prototype.hasOwnProperty("trim")||(String.prototype.trim=function(){return this.replace(d,"")}),b.is_true=h,b.register("trim",function(a){return"string"==typeof a?a.trim():a}).register("ltrim",function(a){return"string"==typeof a?a.replace(/^\s+/,""):a}).register("rtrim",function(a){return"string"==typeof a?a.replace(/\s+$/,""):a}).register("add",function(a){var b,c;if("number"==typeof a&&arguments.length>1){for(b=a,c=1;c<arguments.length;c++)b+=parseFloat(arguments[c]);return b}return a}).register("capfirst",function(a){return"string"==typeof a?a.replace(/^([a-z])/,function(a){return a.toUpperCase()}):a}).register("cut",function(a,b){return"string"==typeof a&&b?a.replace(new RegExp(b,"g"),""):a}).register("default",function(a,b){return h(a)?a:b}).register("sort",function(a,b){var c,d;if(a instanceof Array&&a.length>0){if("undefined"==typeof b){if("string"==typeof a[0])return a.sort();if("number"==typeof a[0]||"boolean"==typeof a[0])return a.sort(function(a,b){return a-b});for(c in a[0]){b=c;break}if("undefined"==typeof b)return a}if(a[0].hasOwnProperty(b))return d=function(a){return function(b,c){var d,e;if("object"==typeof b&&"object"==typeof c&&b&&c)return d=b[a],e=c[a],d===e?0:typeof d==typeof e?e>d?-1:1:typeof e>typeof d?-1:1;throw"error"}},a.sort(d(b))}return a}).register("reverse",function(a,c){return b.__builtins.sort(a,c).reverse()}).register("escape",function(a){return a.replace(/[<>'"]|&(?!amp;)/g,function(a){return g[a]})}).register("length",function(a){return"string"==typeof a||a instanceof Array?a.length:a}).register("lower",function(a){return"string"==typeof a?a.toLowerCase():a}).register("upper",function(a){return"string"==typeof a?a.toUpperCase():a}).register("striptags",function(a){return"string"==typeof a?a.replace(/<(?:.|\s)*?>/g,""):a}).register("title",function(a){return"string"==typeof a?a.replace(/\B(\w*)/g,function(a){return a.toLowerCase()}).replace(/\b(\w)|\b(\w)/g,function(a){return a.toUpperCase()}):a}).register("truncate",function(a,b){return"string"==typeof a?a.length>b?a.substring(0,b-3)+"...":a:a}),j.prototype.eos=function(){return this.position>=this.length},j.prototype.skipWhiteSpace=function(){if(!(this.position>=this.length))for(var a=this.source.charAt(this.position);this.position<this.length&&i(a);)this.position+=1,a=this.source.charAt(this.position)},j.prototype.pop=function(){return this.source.charAt(this.position++)},j.prototype.back=function(a){this.position-=0==arguments.length?1:a},j.prototype.skipTo=function(a){var b=this.source.substring(this.position),c=a.length,d=b.indexOf(a);return d>-1?(this.position+=d+c,this.position):(this.position=this.length,-1)},j.prototype.copy=function(a,b){return this.source.substring(a,b)},j.prototype.readWord=function(){for(var a=this.position,b=this.source.charAt(this.position++);!this.eos()&&!i(b);)b=this.source.charAt(this.position++);return this.source.substring(a,this.position-1)},k={},l={9:"\\t",13:"\\r",10:"\\n"},n={get:function(b){var c,d,e;return k.hasOwnProperty(b)?c=k[b]:"document"in a&&(d=document.getElementById(b),d&&(e=d.value||d.innerHTML,c=n.compile(e.trim()),k[b]=c)),c},parse_filter:function(a){var c,d,e,f,g,b=a.lastIndexOf("|");return b>0?(c=a.substr(0,b),d=a.substr(b+1),e=n.parse_filter(c),f=d.split(":"),g="_."+f[0].trim(),f.length>1?g+"("+e+","+f[1].trim()+")":g+"("+e+")"):a.trim()},compile:function(a){var c,d,g,h,i,k,l,o,p,t,u,v,w,x,y,z,A,B,b=new j(a);for(b.skipWhiteSpace(),k=[],k.push('var _html = "";'),l=1,p=[],i=b.position;!b.eos();)switch(h=b.position,c=b.pop()){case"{":if(!b.eos())if(h>i&&k.push('_html+="'+m(b.copy(i,h))+'";'),i=b.position,d=b.pop(),"{"===d){if(g=b.pop(),"{"!=g){if(h=b.position,i=b.skipTo("}}"),-1==i)throw'Syntax Error, "}}" is required.';t=b.copy(h-1,i-2).trim(),u=n.parse_filter(t),k.push("_html+="+u+";")}}else if("%"===d){if(b.skipWhiteSpace(),v=b.readWord(),b.skipWhiteSpace(),h=b.position,i=b.skipTo("%}"),i>-1)if(t=b.copy(h,i-2).trim(),"if"==v||"elif"==v){for(w=t.split(/\s*(and|or|\(|\))\s*/g),x=[],y=0;y<w.length;y++)z=w[y],/and|or|\(|\)/.test(z)?"and"==z?x.push("&&"):"or"==z?x.push("||"):x.push(z):(u=n.parse_filter(t),x.push("is_true("+u+")"));"if"==v?(p.push("if"),k.push("if("+x.join()+"){")):k.push("} else if("+x.join()+"){")}else if("else"==v)k.push("} else {");else if("endfor"==v||"endif"==v||"endwith"==v){if(A=p.pop(),v!="end"+A)throw"Syntax Error, Block tag "+A+" required end"+A+" as endtag sign.";k.push("}")}else if("for"==v){if(p.push("for"),o="$var_"+l++,!e.test(t))throw'Syntax error for "for" expression.';u=n.parse_filter(RegExp.$2),B="var "+o+"="+u+";",B+="for(var i=0;i<"+o+".length;i++){var "+RegExp.$1+"="+o+"[i];",k.push(B)}else if("with"==v)for(p.push("with"),w=t.match(f),k.push("{"),y=0;y<w.length;y++)k.push("var "+w[y]+";")}else"#"===d?i=b.skipTo("#}"):k.push('_html += "'+m(b.copy(h,i))+'";')}if(h>i&&k.push('_html += "'+m(b.copy(i,h+1))+'";'),p.length>0)throw'Syntax Error, "'+p.join()+'" need endtag signed.';return k.push(" return _html;"),{render:new Function("context",k.join(""))}}},b.compile=n.compile,b.get_template=n.get}(this);