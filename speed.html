<!DOCTYPE html>
<html>
  <head>
    <meta charset='utf-8' />
    <meta http-equiv="X-UA-Compatible" content="chrome=1" />
    <title>Surge.js : Speed Test</title>
    <meta name="description" content="Surge.js -- A Javascript template engine." />
    <meta name="keywords" content="Surge.js, Javascript template, js template"/>
    
    <link rel="stylesheet" type="text/css" media="screen" href="static/css/stylesheet.css">
    <script src="static/js/jquery-1.7.2.min.js"></script>
    <script src="static/js/highcharts.js"></script>
    <script src="https://rawgithub.com/guangboo/surge.js/master/surge.js"></script>
    
    <script src="https://rawgithub.com/aui/artTemplate/master/dist/template.js"></script>
    <script src="https://rawgithub.com/olado/doT/master/doT.min.js"></script>
    <script src="https://rawgithub.com/PaulGuo/Juicer/master/build/juicer-min.js"></script>
    
    <script src="https://rawgithub.com/ktmud/kissy/master/build/kissy-min.js"></script>
    <script src="https://rawgithub.com/ktmud/kissy/master/build/template/template-pkg-min.js"></script>
    
    <script src="https://rawgithub.com/janl/mustache.js/master/mustache.js"></script>
    <script src="http://builds.handlebarsjs.com.s3.amazonaws.com/handlebars-v1.2.0.js"></script>
    <script src="https://rawgithub.com/wangxiao/BaiduTemplate/master/baiduTemplate.js"></script>
    <!--<script src="js/jquery.tmpl.js"></script>
    <script src="js/easytemplate.js"></script>-->
    <script src="http://documentcloud.github.io/underscore/underscore.js"></script>
        
    <script>
    var length = 100;
    var number = 10000;

    var data = {
        list: []
    };

    for (var i = 0; i < length; i ++) {
        data.list.push({
            index: i,
            user: '<strong style="color:red">Hello!</strong>',
            site: 'http://www.planeart.cn',
            weibo: 'http://weibo.com/planeart',
            QQweibo: 'http://t.qq.com/tangbin'  
        }); 
    };

    var testList = [
        {
            name: 'surge.js',
            tester: function () {
                var source = document.getElementById('surge_template').innerHTML;
                var tmpl = surge.compile(source);
                for (var i = 0; i < number; i ++) {
                    tmpl.render(data);
                }
            }
        },
        {
            name: 'artTemplate',
            tester: function () {
                template.isEscape = false;
                var source = document.getElementById('template').innerHTML;
                var fn = template.compile(source);
                for (var i = 0; i < number; i ++) {
                    fn(data);
                }
            }
        },
        {
            name: 'juicer',
            tester: function () {
                var config = {cache:true};

                var source = document.getElementById('juicer').innerHTML;
                for (var i = 0; i < number; i ++) {
                    juicer.to_html(source, data, config);
                }
            }
        },
        {
            name: 'doT',
            tester: function () {
                var source = document.getElementById('doT').innerHTML;
                var doTtmpl = doT.template(source);
                for (var i = 0; i < number; i ++) {
                    doTtmpl(data);
                }
            }
        },
        {
            name: 'Handlebars',
            tester: function () {
                var source = document.getElementById('Handlebars').innerHTML;
                var fn = Handlebars.compile(source);
                for (var i = 0; i < number; i ++) {
                    fn(data);
                }
            }
        },
        {
            name: 'underscoreTemplate',
            tester: function () {
                var source = document.getElementById('underscoreTemplate').innerHTML;
                var fn = _.template(source);
                for (var i = 0; i < number; i ++) {
                    fn(data);
                }
            }
        },
        {
            name: 'baiduTemplate',
            tester: function () {
                var bt=baidu.template;
                bt.ESCAPE = false;
                for (var i = 0; i < number; i ++) {
                    bt('baidu-template', data);
                }
            }
        },
        {
            name: 'Mustache',
            tester: function () {
                var source = document.getElementById('Mustache').innerHTML;
                for (var i = 0; i < number; i ++) {
                    Mustache.to_html(source, data);
                }
            }
        }
    ];

    KISSY.use('template',function(S,T) {
        testList.push({
            name: 'kissyTemplate',
            tester: function () {
                var source= document.getElementById('kissy').innerHTML;

                for (var i = 0; i < number; i ++) {
                    T(source).render(data);
                }
            }
        });
    });


    var startTest = function () {
        var Timer = function (){
            this.startTime = + new Date;
        };

        Timer.prototype.stop = function(){
            return + new Date - this.startTime;
        };
        
        var colors = Highcharts.getOptions().colors;
        var categories = [];

        for (var i = 0; i < testList.length; i ++) {
            categories.push(testList[i].name);
        }

        var chart = new Highcharts.Chart({
            chart: {
                renderTo: 'container',
                height: categories.length * 40,
                type: 'bar'
            },

            title: {
                text: 'JavaScript Template Engine Test'
            },

            subtitle: {
                text: length + ' data x ' + number + ' times rendering.'
            },
                    
            xAxis: {
                categories: categories,
                labels: {
                    align: 'right',
                    style: {
                        fontSize: '12px',
                        fontFamily: 'Verdana, sans-serif'
                    }
                }
            },

            yAxis: {
                min: 0,
                title: {
                    text: 'Time(ms))'
                }
            },

            legend: {
                enabled: false
            },

            tooltip: {
                formatter: function() {
                    return '<b>'+ this.x +'</b><br/>'+
                        this.y + 'ms';
                }

            },

            credits: {
                enabled: false
            },
            plotOptions: {
                bar: {
                    dataLabels: {
                        enabled: true,
                        formatter: function () {
                            return this.y + 'ms';
                        }
                    }
                }
            },
            series: [{
                data : []
            }]

        });
        
        var log = function (message) {
            document.getElementById('log').innerHTML = message;
        };
        
        var tester = function (target) {
            var time = new Timer;
            target.tester();
            var endTime = time.stop();
            
            chart.series[0].addPoint({
                color: colors.shift(),
                y: endTime
            });
            
            if (!testList.length) {
                log('Finish! Dont focus on speed.');
                return;
            }

            target = testList.shift();
            log('Testing: ' + target.name + '..');
            setTimeout(function () {
                tester(target);
            }, 500);
        };
        
        var target = testList.shift();
        log('Testing: ' + target.name + '..');
        tester(target);
    };
    </script>
  </head>

  <body>
    <!-- HEADER -->
    <div id="header_wrap" class="outer">
        <header class="inner">
          <a id="forkme_banner" href="https://github.com/guangboo/surge.js">View on GitHub</a>

          <h1 id="project_title">Surge.js</h1>
          <h2 id="project_tagline"></h2>

            <section id="downloads">
              <a class="zip_download_link" href="https://github.com/guangboo/surge.js/zipball/master">Download this project as a .zip file</a>
              <a class="tar_download_link" href="https://github.com/guangboo/surge.js/tarball/master">Download this project as a tar.gz file</a>
            </section>
        </header>
    </div>
        
    <div id="main_content_wrap" class="outer">
        <section id="main_content" class="inner">
            <h1>Template Engine Render Speed Test</h1>
            <p><strong><script>document.write(length)</script></strong>(s) data x <strong><script>document.write(number)</script></strong> (s)time render [isEscape:false, isCache:true]</p>
            <p>You should run this test with several different web browsers, And <em>Google Chrome with v8 javascript engine</em> is a good choice.</p>
            <p><button id="button-test" onclick="this.disabled=true;startTest()" style="padding: 5px;">Start Test&raquo;</button> <span id="log" style="font-size:12px"><script>for (var i = 0; i < testList.length; i ++) {document.write(testList[i].name + '; ')}</script></span></p>
            <div id="container" style="min-width: 400px; margin: 0 auto"></div>
        </section>
    </div>
    <!-- FOOTER  -->
    <div id="footer_wrap" class="outer">
      <footer class="inner">
        <p class="copyright">Surge.js maintained by <a href="mailto:guangboo49@gmail.com">Theo, &lt;guangboo49@gmail.com&gt;</a></p>
        <p>Published with <a href="http://pages.github.com">GitHub Pages</a></p>
      </footer>
    </div>
    <script type="text/javascript">
        var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
        document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
    </script>
    <script type="text/javascript">
        try {
            var pageTracker = _gat._getTracker("UA-46703623-1");
            pageTracker._trackPageview();
        } catch(err) {}
    </script>
    <!-- surge template -->
    <script id="surge_template" type="text/template">
    <ul>
        {% for item in list %}
            <li>{{ item.index }} User:{{ item.user }}/ Site:{{ item.site }}</li>
        {% endfor %}
    </ul>
    </script>
        
    <!-- artTemplate -->
    <script id="template" type="text/tmpl">
    <ul>
        <% for (i = 0, l = list.length; i < l; i ++) { %>
            <li><%=list[i].index%>. User: <%=list[i].user%>/ Site:<%=list[i].site%></li>
        <% } %>
    </ul>
    </script>

    <!-- baidu-template -->
    <script id="baidu-template" type="text/tmpl">
    <ul>
        <% for (var val, i = 0, l = list.length; i < l; i ++) { %>
            <% val = list[i]; %>
            <li><%:=val.index%>. User: <%:=val.user%>/ Site:<%:=val.site%></li>
        <% } %>
    </ul>
    </script>

    <!-- easyTemplate -->
    <script id="easyTemplate" type="text/tmpl">
    <ul>
        <#list data.list as item>
            <li>${item.index}. User: ${item.user}/ Site:${item.site}</li>
        </#list>
    </ul>
    </script>

    <!-- tmpl -->
    <script id="tmpl" type="text/tmpl">
    <ul>
        <% for (var val, i = 0, l = list.length; i < l; i ++) { %>
            <% val = list[i]; %>
            <li><%=val.index%>. User: <%=val.user%>/ Site:<%=val.site%></li>
        <% } %>
    </ul>
    </script>

    <!-- jqueryTmpl -->
    <script id="jqueryTmpl" type="text/tmpl">
    <ul>
        {{each list}}
            <li>${$value.index}. User: ${$value.user}/ Site:${$value.site}</li>
        {{/each}}
    </ul>
    </script>

    <!--juicer -->
    <script id="juicer" type="text/tmpl">
    <ul>
        {@each list as val}
            <li>$${val.index}. User: $${val.user}/ Site:$${val.site}</li>
        {@/each}
    </ul>
    </script>

    <!-- doT -->
    <script id="doT" type="text/tmpl">
    <ul>
        {{ for (var val, i = 0, l = it.list.length; i < l; i ++) { }}
            {{ val = it.list; }}
            <li>{{=val[i].index}}. User: {{=val[i].user}}/ Site:{{=val[i].site}}</li>
        {{ } }}
    </ul>
    </script>

    <!--Mustache -->
    <script id="Mustache" type="text/tmpl">
    <ul>
        {{#list}}
            <li>{{{index}}}. User: {{{user}}}/ Site:{{{site}}}</li>
        {{/list}}
    </ul>
    </script>

    <!--Handlebars  -->
    <script id="Handlebars" type="text/tmpl">
    <ul>
        {{#list}}
            <li>{{{index}}}. User: {{{user}}}/ Site:{{{site}}}</li>
        {{/list}}
    </ul>
    </script>

    <!--kissy -->
    <script id="kissy" type="text/tmpl">
    <ul>
        {{#each list as val}}
            <li>{{val.index}}. User: {{val.user}}/ Site:{{val.site}}</li>
        {{/each}}
    </ul>
    </script>


    <!-- ejs -->
    <script id="ejs" type="text/tmpl">
    <ul>
      <& for (var val, i = 0, l = @list.length; i < l; i ++) { &>
            <& val = @list[i]; &>
            <li> <&= val.index &>. User: <&= val.user &>£» Site:<&= val.site &></li> 
      <& } &>
    </ul>
    </script>

    <!-- underscore -->
    <script id="underscoreTemplate" type="text/tmpl">
    <ul>
        <% for (var i = 0, l = list.length; i < l; i ++) { %>
            <li><%=list[i].index%>. User: <%=list[i].user%>/ Site:<%=list[i].site%></li>
        <% } %>
    </ul>
    </script>
</body>
</html>