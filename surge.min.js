!function(a){function h(a){return!!a&&(!(a instanceof Array)||a.length>0)}function i(a){return regex_number.test(a[0])||regex_const_string.test(a)}function j(a){return!/\S/.test(a)}function k(a){this.source=a,this.position=0,this.length=a.length}function n(a){return a.replace(/("|')/g,"\\$1").replace(/(\t|\r|\n)/g,function(a){return m[a.charCodeAt()]})}var d,e,f,g,l,m,b=a.surge={};b.version="0.2.4 Alpha",b.debug=!0,b.__builtins={},b.register=function(a,b){if(/^[_a-zA-Z]\w*/.test(a))return this.__builtins[a]=b,this;throw'"'+a+'" is not valid filter name.'},d=/^\s+|\s+$/g,e=/(\w+)\s+in\s+(.*)/,f=/((?:\w+)\s*=\s*(?:[\w\.]+))+/g,regex_number=/[-+\.\d]/,regex_const_string=/^(['"]).*\1$/,g={"<":"&lt;",">":"&gt;",'"':"&#39;","'":"&quot;","&":"&amp;"},String.prototype.hasOwnProperty("trim")||(String.prototype.trim=function(){return this.replace(d,"")}),b.is_true=h,b.register("trim",function(a){return"string"==typeof a?a.trim():a}).register("ltrim",function(a){return"string"==typeof a?a.replace(/^\s+/,""):a}).register("rtrim",function(a){return"string"==typeof a?a.replace(/\s+$/,""):a}).register("add",function(a){var b,c;if("number"==typeof a&&arguments.length>1){for(b=a,c=1;c<arguments.length;c++)b+=parseFloat(arguments[c]);return b}return a}).register("capfirst",function(a){return"string"==typeof a?a.replace(/^([a-z])/,function(a){return a.toUpperCase()}):a}).register("cut",function(a,b){return"string"==typeof a&&b?a.replace(new RegExp(b,"g"),""):a}).register("default",function(a,b){return h(a)?a:b}).register("sort",function(a,b){var c,d;if(a instanceof Array&&a.length>0){if("undefined"==typeof b){if("string"==typeof a[0])return a.sort();if("number"==typeof a[0]||"boolean"==typeof a[0])return a.sort(function(a,b){return a-b});for(c in a[0]){b=c;break}if("undefined"==typeof b)return a}if(a[0].hasOwnProperty(b))return d=function(a){return function(b,c){var d,e;if("object"==typeof b&&"object"==typeof c&&b&&c)return d=b[a],e=c[a],d===e?0:typeof d==typeof e?e>d?-1:1:typeof e>typeof d?-1:1;throw"error"}},a.sort(d(b))}return a}).register("reverse",function(a,c){return b.__builtins.sort(a,c).reverse()}).register("escape",function(a){return a.replace(/[<>'"]|&(?!amp;)/g,function(a){return g[a]})}).register("length",function(a){return"string"==typeof a||a instanceof Array?a.length:a}).register("lower",function(a){return"string"==typeof a?a.toLowerCase():a}).register("upper",function(a){return"string"==typeof a?a.toUpperCase():a}).register("striptags",function(a){return"string"==typeof a?a.replace(/<(?:.|\s)*?>/g,""):a}).register("title",function(a){return"string"==typeof a?a.replace(/\B(\w*)/g,function(a){return a.toLowerCase()}).replace(/\b(\w)|\b(\w)/g,function(a){return a.toUpperCase()}):a}).register("truncate",function(a,b){return"string"==typeof a?a.length>b?a.substring(0,b-3)+"...":a:a}),k.prototype.eos=function(){return this.position>=this.length},k.prototype.skipWhiteSpace=function(){if(!(this.position>=this.length))for(var a=this.source.charAt(this.position);this.position<this.length&&j(a);)this.position+=1,a=this.source.charAt(this.position)},k.prototype.pop=function(){return this.source.charAt(this.position++)},k.prototype.back=function(a){this.position-=0==arguments.length?1:a},k.prototype.skipTo=function(a){var b=this.source.substring(this.position),c=a.length,d=b.indexOf(a);return d>-1?(this.position+=d+c,this.position):(this.position=this.length,-1)},k.prototype.copy=function(a,b){return this.source.substring(a,b)},k.prototype.readWord=function(){for(var a=this.position,b=this.source.charAt(this.position++);!this.eos()&&!j(b);)b=this.source.charAt(this.position++);return this.source.substring(a,this.position-1)},l={},m={9:"\\t",13:"\\r",10:"\\n"},b.get_template=function(c){var d,e,f;return l.hasOwnProperty(c)?d=l[c]:"document"in a&&(e=document.getElementById(c),e&&(f=e.value||e.innerHTML,d=b.compile(f.trim()),l[c]=d)),d},b.compile=function(a){function r(a){return-1!==q.indexOf(a)}function s(a){var c,d,e,f,g,b=a.lastIndexOf("|");return b>0?(c=a.substr(0,b),d=a.substr(b+1),e=s(c),f=d.split(":"),g="_."+f[0].trim(),f.length>1?g+"("+e+","+f[1].trim()+")":g+"("+e+")"):(a=a.trim(),i(a)||r(a.split(".")[0])?a:"context."+a)}var c,d,g,h,j,l,m,o,p,q,t,u,v,w,x,y,z,A,B,C,D,E,F,G,b=new k(a);for(b.skipWhiteSpace(),l="",l+='var _html = "";var _ = surge.__builtins;',m=1,p=[],q=[],j=b.position;!b.eos();)switch(h=b.position,c=b.pop()){case"{":if(!b.eos())if(h>j&&(l+='_html+="'+n(b.copy(j,h))+'";'),j=b.position,d=b.pop(),"{"===d){if(g=b.pop(),"{"!=g){if(h=b.position,j=b.skipTo("}}"),-1==j)throw'Syntax Error, "}}" is required.';t=b.copy(h-1,j-2).trim(),u=s(t),l+="_html+="+u+";"}}else if("%"===d){if(b.skipWhiteSpace(),v=b.readWord(),b.skipWhiteSpace(),h=b.position,j=b.skipTo("%}"),j>-1)if(t=b.copy(h,j-2).trim(),"if"==v||"elif"==v){for(w=t.split(/\s*(and|or|\(|\))\s*/g),x=[],y=0;y<w.length;y++)if(z=w[y],i(z))x.push(z);else if(/and|or|\(|\)/.test(z))"and"==z?x.push("&&"):"or"==z?x.push("||"):x.push(z);else if(A=z.split(/(==|>=|<=|<|>)/),u="",A.length>1){for(u="(",B=0;B<A.length;B++)C=A[B],u+=i(C)||/==|>=|<=|<|>/.test(C)?C:s(C);u+=")",x.push(u)}else u=s(z),x.push("surge.is_true("+u+")");"if"==v?(p.push("if"),l+="if("+x.join("")+"){"):l+="} else if("+x.join("")+"){"}else if("else"==v)l+="} else {";else if("endfor"==v||"endif"==v||"endwith"==v){if(D=p.pop(),v!=="end"+D)throw"Syntax Error, Block tag "+D+" required end"+D+" as endtag sign.";l+="}",("endfor"===v||"endwith"===v)&&q.pop()}else if("for"==v){if(p.push("for"),o="$var_"+m++,!e.test(t))throw'Syntax error for "for" expression.';u=s(RegExp.$2),E="var "+o+"="+u+";",E+="for(var i=0,j="+o+".length;i<j;i++){var "+RegExp.$1+"="+o+"[i];",q.push(RegExp.$1),l+=E}else if("with"==v)for(p.push("with"),w=t.match(f),l+="{",y=0;y<w.length;y++)A=w[y].split("="),F=A[0].trim(),G=s(A[1].trim()),l+="var "+F+"="+G+";",q.push(F)}else"#"===d?j=b.skipTo("#}"):l+='_html+="'+n(b.copy(h,j))+'";'}if(h>j&&(l+='_html += "'+n(b.copy(j,h+1))+'";'),p.length>0)throw'Syntax Error, "'+p.join()+'" need endtag signed.';return l+=" return _html;",{render:new Function("context",l)}}}(this);